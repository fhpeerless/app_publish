// 应用数据（模拟后端数据，可替换为真实接口请求）
const appData = [
    {
        id: 1,
        title: "谷歌多开",
        tag: "脚本源码",
        shortDesc: "一键多开指定数量的google的浏览器。",
        fullDesc: `
            <h4>核心功能</h4>
            <ul>
                <li>存储位置自定义%+</li>
                <li>多开数量自定义</li>
                <li>每个多开相互独立</li>
                <li>几秒中创建上百个google新页面</li>
                <li>离线编辑模式，无网络也能正常使用</li>
                <li>源代码支持，不用担心google中数据泄露的问题</li>
            </ul>
            <h4>适配平台</h4>
            <p>Windows / macOS /</p>
            <h4>更新日志</h4>
            <p>v2.1.0 (2025-01-15)：新增AI总结功能，支持一键生成笔记摘要</p>
        `,
        userAgreement: `
            <h4>应用使用协议</h4>
            <ol>
                <li>本软件提供的是谷歌浏览器多开功能，仅供用户个人学习和研究使用。</li>
                <li>用户在使用本软件时，应当遵守国家相关法律法规，不得用于任何非法用途。</li>
                <li>本软件不对用户使用过程中产生的任何损失或风险承担责任。</li>
                <li>用户购买源码后，将获得源码的使用权，即为获得自由处置权。</li>
                <li>本软件的最终解释权归开发者所有。</li>
            </ol>
        `,
        imgUrl: "http://note.youdao.com/yws/api/personal/file/WEB79d78a617be5ec4646dc4f2b5d336d85?method=download&inline=true&shareKey=189edebbb9b455dc8a57a7c6184cf765",
        videoEmbed: "",
        downloadLinks: [
            { platform: "源码购买", link: "https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&page=detailuniversal_detail&saleType=10&itemsId=12328456&loadingShow=1&noTitleBar=1&msource=merchant_share" },
            { platform: "源码购买", link: "https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&page=detailuniversal_detail&saleType=10&itemsId=12328456&loadingShow=1&noTitleBar=1&msource=merchant_share" }
        ]
    },
    {
        id: 2,
        title: "获取目录内的空间使用情况",
        tag: "脚本源码",
        shortDesc: "根据各个文件夹所占空间大小依次排列。",
        fullDesc: `
            <h4>核心功能</h4>
            <ul>
                <li>文件小，容易存储</li>
                <li>源码开源不存在使用问题</li>
                <li>对电脑影响较小</li>
                 <li>购买后自动发送源码</li>
                <li>每个文件夹的空间大小清晰可见，</li>
                <li>按大小清除无用垃圾，避免清里程序清理不到的自用缓存文件</li>
            </ul>
            <h4>适配平台</h4>
            <p>Windows / macOS </p>
            <h4>更新日志</h4>
            <p>v1.0.0 (2025-)</p>
        `,
        userAgreement: `
            <h4>应用使用协议</h4>
            <ol>
                <li>本脚本用于获取目录内的空间使用情况，仅供用户个人学习和研究使用。</li>
                <li>用户在使用本脚本时，应当遵守国家相关法律法规，不得用于任何非法用途。</li>
                <li>本源码不对用户使用过程中产生的任何损失或风险承担责任。</li>
                <li>用户购买源码后，将获得源码的使用权，即为获得自由处置权。</li>
                <li>本程序的最终解释权归开发者所有。</li>
          
            </ol>
        `,
        imgUrl: "https://picsum.photos/seed/app2/800/400",
       
        downloadLinks: [
            { platform: "源码购买", link: "https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&page=detailuniversal_detail&saleType=10&itemsId=40086188&loadingShow=1&noTitleBar=1&msource=merchant_share" },
            { platform: "源码购买", link: "https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&page=detailuniversal_detail&saleType=10&itemsId=40086188&loadingShow=1&noTitleBar=1&msource=merchant_share" }
        ]
    },
    {
        id: 3,
        title: "wx_auto",
        tag: "windows",
        shortDesc: "可视化任务管理工具，支持自定义标签、截止日期提醒。",
        fullDesc: `
            <h4>核心功能</h4>
            <ul>
                <li>模拟人工无风控风险</li>
             
                <li>自动添加friends.txt每一个好友</li>
                <li>兼容friends.txt 空行隔断</li>
                 <li>自动记录添加成功或缺席的好友</li>
                <li>自动记录添加好友频繁的时间</li>       

                <p>/ windows / 网页端</p>
            <h4>更新日志</h4>
            <p>v1.3.0 (2025-012-14)</p>
        `,
        userAgreement: `
            <h4>应用使用协议</h4>
            <ol>
                <li>本程序用于个人和商业，仅供用户个人学习和研究使用。</li>
                <li>用户在使用本应用时，应当遵守国家相关法律法规，不得用于任何非法用途。</li>
                <li>本应用不对用户使用过程中产生的任何损失或风险承担责任。</li>
                <li>用户购买应用后，将获得应用的使用权，但不得对应用进行破解、修改、反编译等操作。</li>
                <li>本应用的最终解释权归开发者所有。</li>
            </ol>
        `,
        imgUrl: "http://note.youdao.com/yws/api/personal/file/WEB79d78a617be5ec4646dc4f2b5d336d85?method=download&inline=true&shareKey=189edebbb9b455dc8a57a7c6184cf765",
        downloadLinks: [
            { platform: "下载应用", link: "https://juanhaoduo.lanzoub.com/ioHVp3dxgavc" },
            { platform: "购买密钥", link: "https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&page=detailuniversal_detail&saleType=10&itemsId=40116905&loadingShow=1&noTitleBar=1&msource=merchant_share" }
        ]
    },
    {
        id: 4,
        title: "跨设备交互",
        tag: "windows",
        shortDesc: "移动端和pc之间的通信。",
        fullDesc: `
            <h4>核心功能</h4>
            <ul>
                <li>设备之间发送传文件</li>
             
                <li>设备之间发送消息</li>
                <li>手机实现设置电脑定时关机，电脑立即关机</li>
                 <li>下载文件接受文件</li>

                <p>/ windows / web/ ipone</p>
            <h4>更新日志</h4>
            <p>v1.4.0 (2025-012-18)</p>
        `,
        userAgreement: `
            <h4>应用使用协议</h4>
            <ol>
                <li>本程序用于个人和商业，等适用场景。</li>
                <li>用户在使用本应用时，应当遵守国家相关法律法规，不得用于任何非法用途。</li>
                <li>本应用不对用户使用过程中因丢失文件所产生的损失或风险承担责任。</li>
                <li>本应用无任何毒副作用，不产生任何注册表等，删除程序本身，即可完全删除程序不留垃圾，本程序无用户任何隐私的获取，只包含功能实现代码。</li>
                <li>用户购买应用后，将获得应用的使用权，但不得对应用进行破解、修改、反编译等操作，（源码除外）。</li>
                <li>本应用的最终解释权归开发者所有。</li>
            </ol>
        `,
        imgUrl: "http://note.youdao.com/yws/api/personal/file/WEB79d78a617be5ec4646dc4f2b5d336d85?method=download&inline=true&shareKey=189edebbb9b455dc8a57a7c6184cf765",
               videoEmbed: '<iframe src="//player.bilibili.com/player.html?isOutside=true&aid=115743899256522&bvid=BV1gFqRBaE1f&cid=34831535997&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>',
        downloadLinks: [
            { platform: "下载应用", link: "https://juanhaoduo.lanzoub.com/iRuZ33e9qhyj" },
            { platform: "购买程序", link: "https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&page=detailuniversal_detail&saleType=10&itemsId=40143016&loadingShow=1&noTitleBar=1&msource=merchant_share" },
            { platform: "购买源码", link: "https://mall.bilibili.com/neul-next/detailuniversal/detail.html?isMerchant=1&page=detailuniversal_detail&saleType=10&itemsId=40139910&loadingShow=1&noTitleBar=1&msource=merchant_share" }
        ]
    },
    {
        id: 5,
        title: "biliauto",
        tag: "windows",
        shortDesc: "指定视频指定评论自动发送消息。",
        fullDesc: `
            <h4>核心功能</h4>
            <ul>
                <li>自动找评论</li>
             
                <li>自动发送消息</li>
                <li>自动跳过已经发送过的消息</li>
                 <li>自动检查关注</li>

                <p>/ windows / web/ ipone</p>
            <h4>更新日志</h4>
            <p>v1.4.0 (2025-012-25)</p>
        `,
        userAgreement: `
            <h4>应用使用协议</h4>
            <ol>
                <li>本程序用于个人和商业，等适用场景。</li>
                <li>用户在使用本应用时，应当遵守国家相关法律法规，不得用于任何非法用途。</li>
                <li>本应用不对用户使用过程中因丢失文件所产生的损失或风险承担责任。</li>
                <li>本应用无任何毒副作用，不产生任何注册表等，删除程序本身，即可完全删除程序不留垃圾，本程序无用户任何隐私的获取，只包含功能实现代码。</li>
                <li>用户购买应用后，将获得应用的使用权，但不得对应用进行破解、修改、反编译等操作，（源码除外）。</li>
                <li>本应用的最终解释权归开发者所有。</li>
            </ol>
        `,
        imgUrl: "http://note.youdao.com/yws/api/personal/file/WEB79d78a617be5ec4646dc4f2b5d336d85?method=download&inline=true&shareKey=189edebbb9b455dc8a57a7c6184cf765",
              
        downloadLinks: [
            { platform: "下载应用", link: "https://juanhaoduo.lanzoub.com/iOZs13ehswqb" }

        ]
    }
];

// DOM元素获取
const appListPage = document.getElementById('appListPage');
const appDetailPage = document.getElementById('appDetailPage');
const appGrid = document.getElementById('appGrid');
let appCards;

// 页面切换函数
function showDetailPage(appId) {
    // 隐藏列表页，显示详情页
    appListPage.classList.remove('active');
    appDetailPage.classList.add('active');

    // 查找对应应用数据
    const app = appData.find(item => item.id === parseInt(appId));
    if (!app) return;

    // 渲染详情页内容
    const detailImgContainer = document.querySelector('.detail-img');
    
    // 清空容器内容
    detailImgContainer.innerHTML = '';
    
    if (app.videoEmbed) {
        // 如果有视频嵌入代码，显示视频并添加图片作为备选
        // 修改B站播放器参数，添加autoplay=0防止自动播放
        let fixedVideoEmbed = app.videoEmbed.replace('&p=1', '&p=1&autoplay=0');
        
        // 创建一个包含视频和图片的容器
        const mediaContainer = document.createElement('div');
        mediaContainer.style.position = 'relative';
        mediaContainer.style.width = '100%';
        mediaContainer.style.height = '100%';
        
        // 创建新的图片元素作为底层显示
        const imgElement = document.createElement('img');
        imgElement.id = 'detailImg';
        imgElement.src = app.imgUrl;
        imgElement.alt = app.title;
        imgElement.style.width = '100%';
        imgElement.style.height = '100%';
        imgElement.style.objectFit = 'cover';
        
        // 添加图片加载错误处理，使用Base64占位图
        imgElement.onerror = function() {
            this.onerror = null;
            // 使用Base64编码的占位图
            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2UyZThmMCIvPgogIDxjaXJjbGUgY3g9IjQwMCIgY3k9IjIwMCIgcj0iNDAiIGZpbGw9IiM5M2M1ZmQiLz4KICA8dGV4dCB4PSI0MDAiIHk9IjIwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzMzNDE1NSIgZm9udC1zaXplPSIxNiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIj7miJHlj4fljJfmmK/lkIPlhb/liqHmuLjlj4zkvJTkuIrlvIDlj6/mp7DmsYPlm77mmK/lkIPlhb/lpKflrp48L3RleHQ+Cjwvc3ZnPg==';
        };
        
        // 添加视频
        const videoDiv = document.createElement('div');
        videoDiv.innerHTML = fixedVideoEmbed;
        videoDiv.style.position = 'absolute';
        videoDiv.style.top = '0';
        videoDiv.style.left = '0';
        videoDiv.style.width = '100%';
        videoDiv.style.height = '100%';
        
        // 尝试获取iframe元素并添加错误处理
        const iframe = videoDiv.querySelector('iframe');
        if (iframe) {
            // 监听iframe加载完成事件
            iframe.onload = function() {
                // 检查iframe内容是否加载成功
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    // 如果能访问到文档，说明视频加载成功
                } catch (e) {
                    // 跨域错误，视频可能无法加载，隐藏视频显示图片
                    videoDiv.style.display = 'none';
                }
            };
            
            // 监听错误事件
            iframe.onerror = function() {
                // 视频加载失败，隐藏视频显示图片
                videoDiv.style.display = 'none';
            };
            
            // 设置超时，如果视频在5秒内还没加载成功，就隐藏视频显示图片
            setTimeout(function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    // 如果iframe内容为空或无法访问，隐藏视频
                    if (!iframeDoc || iframeDoc.body.innerHTML.trim() === '') {
                        videoDiv.style.display = 'none';
                    }
                } catch (e) {
                    videoDiv.style.display = 'none';
                }
            }, 5000);
        }
        
        // 将元素添加到容器
        mediaContainer.appendChild(imgElement);
        mediaContainer.appendChild(videoDiv);
        
        // 将容器添加到详情图容器
        detailImgContainer.appendChild(mediaContainer);
    } else {
        // 否则显示图片 - 创建新的图片元素确保正确显示
        const imgElement = document.createElement('img');
        imgElement.id = 'detailImg';
        imgElement.src = app.imgUrl;
        imgElement.alt = app.title;
        imgElement.style.width = '100%';
        imgElement.style.height = '100%';
        imgElement.style.objectFit = 'cover';
        
        // 添加图片加载错误处理，使用Base64占位图
        imgElement.onerror = function() {
            this.onerror = null;
            // 使用Base64编码的占位图
            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2UyZThmMCIvPgogIDxjaXJjbGUgY3g9IjQwMCIgY3k9IjIwMCIgcj0iNDAiIGZpbGw9IiM5M2M1ZmQiLz4KICA8dGV4dCB4PSI0MDAiIHk9IjIwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzMzNDE1NSIgZm9udC1zaXplPSIxNiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIj7miJHlj4fljJfmmK/lkIPlhb/liqHmuLjlj4zkvJTkuIrlvIDlj6/mp7DmsYPlm77mmK/lkIPlhb/lpKflrp48L3RleHQ+Cjwvc3ZnPg==';
        };
        
        detailImgContainer.appendChild(imgElement);
    }
    
    document.getElementById('detailTitle').textContent = app.title;
    document.getElementById('detailTag').textContent = app.tag;
    document.getElementById('detailDesc').textContent = app.shortDesc;
    document.getElementById('detailFullDesc').innerHTML = app.fullDesc;
    
    // 显示使用协议
    const userAgreementSection = document.getElementById('detailUserAgreement');
    if (userAgreementSection) {
        userAgreementSection.innerHTML = app.userAgreement;
    } else {
        // 如果没有使用协议区域，创建一个
        const detailContent = document.querySelector('.detail-content');
        const agreementDiv = document.createElement('div');
        agreementDiv.id = 'detailUserAgreement';
        agreementDiv.className = 'detail-user-agreement tab-panel';
        agreementDiv.innerHTML = app.userAgreement;
        detailContent.insertBefore(agreementDiv, document.querySelector('.detail-actions'));
    }
    
    // 生成多个下载链接按钮
    const detailActions = document.querySelector('.detail-actions');
    detailActions.innerHTML = '';
    
    if (app.downloadLinks && app.downloadLinks.length > 0) {
        app.downloadLinks.forEach(download => {
            const downloadBtn = document.createElement('a');
            downloadBtn.href = download.link;
            downloadBtn.className = 'btn-primary';
            downloadBtn.target = '_blank';
            downloadBtn.innerHTML = `<i class="fa-solid fa-download"></i> ${download.platform}`;
            detailActions.appendChild(downloadBtn);
        });
    } else {
        // 兼容旧格式，提供默认下载按钮
        const downloadBtn = document.createElement('a');
        downloadBtn.href = app.downloadLink || '#';
        downloadBtn.className = 'btn-primary';
        downloadBtn.target = '_blank';
        downloadBtn.innerHTML = '<i class="fa-solid fa-download"></i> 立即下载';
        detailActions.appendChild(downloadBtn);
    }
    
    // 选项卡切换功能
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanels = document.querySelectorAll('.tab-panel');
    
    // 重置选项卡状态
    tabBtns.forEach(btn => btn.classList.remove('active'));
    tabPanels.forEach(panel => {
        panel.classList.remove('active');
        panel.style.display = 'none';
    });
    
    // 默认显示核心功能
    tabBtns[0].classList.add('active');
    tabPanels[0].classList.add('active');
    tabPanels[0].style.display = 'block';
    
    // 添加选项卡点击事件
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const tab = btn.dataset.tab;
            
            // 移除所有活动状态并隐藏所有面板
            tabBtns.forEach(b => b.classList.remove('active'));
            tabPanels.forEach(p => {
                p.classList.remove('active');
                p.style.display = 'none';
            });
            
            // 添加当前活动状态并显示对应面板
            btn.classList.add('active');
            if (tab === 'fullDesc') {
                const fullDescPanel = document.getElementById('detailFullDesc');
                fullDescPanel.classList.add('active');
                fullDescPanel.style.display = 'block';
            } else if (tab === 'userAgreement') {
                const agreementPanel = document.getElementById('detailUserAgreement');
                agreementPanel.classList.add('active');
                agreementPanel.style.display = 'block';
            }
        });
    });
}

function showListPage() {
    // 隐藏详情页，显示列表页
    appDetailPage.classList.remove('active');
    appListPage.classList.add('active');
}

// 动态生成应用卡片函数
function generateAppCards() {
    // 清空现有卡片
    appGrid.innerHTML = '';
    
    // 遍历应用数据生成卡片
    appData.forEach(app => {
        const card = document.createElement('div');
        card.className = 'app-card';
        card.dataset.id = app.id;
        
        // 生成卡片图片或视频内容
        let mediaContent;
        if (app.videoEmbed) {
            // 为视频添加错误处理和占位符
            // 修改B站播放器参数，添加autoplay=0防止自动播放
            let fixedVideoEmbed = app.videoEmbed.replace('&p=1', '&p=1&autoplay=0');
            mediaContent = `
                ${fixedVideoEmbed}
                <div class="video-placeholder">
                    <i class="fa-solid fa-play-circle"></i>
                    <p>视频无法加载</p>
                </div>
            `;
        } else {
            // 为图片添加错误处理
            mediaContent = `<img src="${app.imgUrl}" alt="${app.title}" onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2UyZThmMCIvPgogIDxjaXJjbGUgY3g9IjQwMCIgY3k9IjIwMCIgcj0iNDAiIGZpbGw9IiM5M2M1ZmQiLz4KICA8dGV4dCB4PSI0MDAiIHk9IjIwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzMzNDE1NSIgZm9udC1zaXplPSIxNiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIj7miJHlj4fljJfmmK/lkIPlhb/liqHmuLjlj4zkvJTkuIrlvIDlj6/mp7DmsYPlm77mmK/lkIPlhb/lpKflrp48L3RleHQ+Cjwvc3ZnPg==';">`;
        }
        
        card.innerHTML = `
            <div class="card-img">
                ${mediaContent}
            </div>
            <div class="card-content">
                <h3 class="card-title">${app.title}</h3>
                <p class="card-desc">${app.shortDesc}</p>
                <div class="card-tag">${app.tag}</div>
            </div>
        `;
        
        appGrid.appendChild(card);
    });
    
    // 更新appCards变量
    appCards = document.querySelectorAll('.app-card');
    
    // 绑定卡片点击事件
    appCards.forEach(card => {
        card.addEventListener('click', () => {
            const appId = card.dataset.id;
            showDetailPage(appId);
        });
    });
}

// 绑定事件

// 初始化函数
function initYingyong() {
    // 生成应用卡片
    generateAppCards();
}

// 页面加载完成后自动初始化
document.addEventListener('DOMContentLoaded', () => {
    initYingyong();
});

// 导出函数（如果需要在其他地方调用）
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        appData,
        generateAppCards,
        showDetailPage,
        showListPage,
        initYingyong
    };
}






















